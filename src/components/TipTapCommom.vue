<template lang='html'>
  <div class='editor' id='editor'>
    <!-- <div ref='toolbar' class='toolbar'>
    </div>
    <div ref='editor' class='text'>
    </div> -->
  </div>
</template>

<script>
import E from 'wangeditor'
export default {
  name: 'TipTapCommom',
  data () {
    return {
      // uploadPath,
      editor: null,
      info_: null
    }
  },
  model: {
    prop: 'value',
    event: 'change'
  },
  props: {
    value: {
      type: String,
      default: '123'
    },
    isClear: {
      type: Boolean,
      default: false
    }
  },
  watch: {
    isClear (val) {
      // è§¦å‘æ¸…é™¤æ–‡æœ¬åŸŸå†…å®¹
      if (val) {
        this.editor.txt.clear()
        this.info_ = null
      }
    },
    value: function (value) {
      if (value !== this.editor.txt.html()) {
        this.editor.txt.html(this.value)
      }
    }
    // valueä¸ºç¼–è¾‘æ¡†è¾“å…¥çš„å†…å®¹ï¼Œè¿™é‡Œæˆ‘ç›‘å¬äº†ä¸€ä¸‹å€¼ï¼Œå½“çˆ¶ç»„ä»¶è°ƒç”¨å¾—æ—¶å€™ï¼Œå¦‚æœç»™valueèµ‹å€¼äº†ï¼Œå­ç»„ä»¶å°†ä¼šæ˜¾ç¤ºçˆ¶ç»„ä»¶èµ‹ç»™çš„å€¼
  },
  mounted () {
    this.seteditor()
    this.editor.txt.html(this.value)
  },
  methods: {
    seteditor () {
      // ä½¿ç”¨refs  åˆ›å»ºå¤šä¸ªæ—¶ä¸ä¼šé”™ä¹±
      // this.editor = new E(this.$refs.toolbar, this.$refs.editor)
      this.editor = new E('#editor')
      // this.editor.customConfig = {
      // menus: []
      // }
      // this.editor.customConfig.uploadImgShowBase64 = false; // base 64 å­˜å‚¨å›¾ç‰‡
      // this.editor.customConfig.uploadImgServer =
      //   'http://otp.cdinfotech.top/file/upload_images'; // é…ç½®æœåŠ¡å™¨ç«¯åœ°å€
      // this.editor.customConfig.uploadImgHeaders = {}; // è‡ªå®šä¹‰ header
      // this.editor.customConfig.uploadFileName = 'file'; // åç«¯æ¥å—ä¸Šä¼ æ–‡ä»¶çš„å‚æ•°å
      // this.editor.customConfig.uploadImgMaxSize = 2 * 1024 * 1024; // å°†å›¾ç‰‡å¤§å°é™åˆ¶ä¸º 2M
      // this.editor.customConfig.uploadImgMaxLength = 6; // é™åˆ¶ä¸€æ¬¡æœ€å¤šä¸Šä¼  3 å¼ å›¾ç‰‡
      // this.editor.customConfig.uploadImgTimeout = 3 * 60 * 1000; // è®¾ç½®è¶…æ—¶æ—¶é—´

      // this.editor.config.customUploadImg = {
      // ä¸Šä¼ å›¾ç‰‡  è¿”å›URL
      // }

      // å›è°ƒå‡½æ•°ï¼Œå¯¹ä¸Šä¼ å›¾ç‰‡çš„ä¸åŒé˜¶æ®µï¼Œåšç›¸åº”å¤„ç†
      // this.editor.customConfig.uploadImgHooks = {
      //   fail: (xhr, editor, result) => {
      //     // æ’å…¥å›¾ç‰‡å¤±è´¥å›è°ƒ
      //   },
      //   success: (xhr, editor, result) => {
      //     // å›¾ç‰‡ä¸Šä¼ æˆåŠŸå›è°ƒ
      //   },
      //   timeout: (xhr, editor) => {
      //     // ç½‘ç»œè¶…æ—¶çš„å›è°ƒ
      //   },
      //   error: (xhr, editor) => {
      //     // å›¾ç‰‡ä¸Šä¼ é”™è¯¯çš„å›è°ƒ
      //   },
      //   customInsert: (insertImg, result, editor) => {
      //     // å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼Œæ’å…¥å›¾ç‰‡çš„å›è°ƒ
      //     // resultä¸ºä¸Šä¼ å›¾ç‰‡æˆåŠŸçš„æ—¶å€™è¿”å›çš„æ•°æ®ï¼Œè¿™é‡Œæˆ‘æ‰“å°äº†ä¸€ä¸‹å‘ç°åå°è¿”å›çš„æ˜¯dataï¼š[{url:'è·¯å¾„çš„å½¢å¼'},...]
      //     console.log(result.data[0].url)
      //     // insertImg() // ä¸ºæ’å…¥å›¾ç‰‡çš„å‡½æ•°
      //     // å¾ªç¯æ’å…¥å›¾ç‰‡
      //     // for (let i = 0; i < 1; i++) {
      //     // console.log(result)
      //     let url = 'http://otp.cdinfotech.top' + result.url
      //     insertImg(url)
      //     // }
      //   }
      // }
      // this.editor.customConfig.onchange = (html) => {
      //   this.info_ = html // ç»‘å®šå½“å‰é€æ¸åœ°å€¼
      //   this.$emit('change', this.info_) // å°†å†…å®¹åŒæ­¥åˆ°çˆ¶ç»„ä»¶ä¸­
      // }

      // é…ç½®èœå•
      // this.editor.config.menus = [
      //   'head', // æ ‡é¢˜
      //   'bold', // ç²—ä½“
      //   'fontSize', // å­—å·
      //   'fontName', // å­—ä½“
      //   'underline', // ä¸‹åˆ’çº¿
      //   'strikeThrough', // åˆ é™¤çº¿
      //   'foreColor', // æ–‡å­—é¢œè‰²
      //   'backColor', // èƒŒæ™¯é¢œè‰²
      //   'lineHeight',
      //   'foreColor',
      //   'link', // æ’å…¥é“¾æ¥
      //   'list', // åˆ—è¡¨
      //   'todo',
      //   'justify', // å¯¹é½æ–¹å¼
      //   'quote', // å¼•ç”¨
      //   'emoticon', // è¡¨æƒ…
      //   'image', // æ’å…¥å›¾ç‰‡
      //   'video', // æ’å…¥è§†é¢‘
      //   'table', // è¡¨æ ¼
      //   'code', // æ’å…¥ä»£ç 
      //   'splitLine',
      //   'undo', // æ’¤é”€
      //   'redo', // é‡å¤
      // ]

      // ä¸å±•ç¤ºçš„èœå•
      this.editor.config.excludeMenus = [
        // 'emoticon',
        'video',
        'code'
      ]
      // è®¾ç½®å­—ä½“é¢œè‰²
      this.editor.config.colors = ['#000000', '#eeece0', '#1c487f', '#4d80bf']
      // è®¾ç½®å­—ä½“
      // this.editor.config.fontNames = [
      //   {name:'å‘µå‘µ',value:'é»‘ä½“'},
      //   'é»‘ä½“'
      // ]

      // è®¾ç½®æ–‡å­—å¤§å° ä¸èƒ½æ–°å¢ï¼Œåªèƒ½å‡å°‘
      // this.editor.config.fontSizes = {
      //   'x-small': { name: '10px', value: '1' },
      //   'small': { name: '13px', value: '2' },
      //   'normal': { name: '16px', value: '3' },
      //   'large': { name: '18px', value: '4' },
      //   'x-large': { name: '24px', value: '5' },
      //   'xx-large': { name: '32px', value: '6' },
      //   'xxx-large': { name: '48px', value: '7' }
      // }

      // è¡¨æƒ…
      // this.editor.config.emotions = [
      //   {
      //     title: 'æ–°æµª', // tab çš„æ ‡é¢˜
      //     type: 'image', // 'emoji' æˆ– 'image' ï¼Œå³ emoji å½¢å¼æˆ–è€…å›¾ç‰‡å½¢å¼
      //     content: [
      //       // {
      //       //   alt: '[åç¬‘]',
      //       //   src: `${SINA_URL_PATH}/50/pcmoren_huaixiao_org.png`,
      //       // },
      //       // { alt: '[èˆ”å±]', src: `${SINA_URL_PATH}/40/pcmoren_tian_org.png` },
      //       // { alt: '[æ±¡]', src: `${SINA_URL_PATH}/3c/pcmoren_wu_org.png` }
      //     ]
      //   },
      //   {
      //     title: 'emoji', // tab çš„æ ‡é¢˜
      //     type: 'emoji', // 'emoji' / 'image'
      //     // emoji è¡¨æƒ…ï¼Œcontent æ˜¯ä¸€ä¸ªæ•°ç»„å³å¯
      //     content:
      //       'ğŸ˜€ ğŸ˜ƒ ğŸ˜„ ğŸ˜ ğŸ˜† ğŸ˜… ğŸ˜‚ ğŸ˜Š ğŸ˜‡ ğŸ™‚ ğŸ™ƒ ğŸ˜‰ ğŸ˜“ ğŸ˜ª ğŸ˜´ ğŸ™„ ğŸ¤” ğŸ˜¬ ğŸ¤'.split(
      //         /\s/
      //       )
      //   }
      // ]
      const _this = this
      this.editor.config.onchange = function (html) {
        // html å³å˜åŒ–ä¹‹åçš„å†…å®¹
        _this.htmlChange(html)
      }
      // ä¸å±•ç¤ºå…¨å±
      this.editor.config.showFullScreen = false

      // this.editor.config.showMenuTooltips = true;

      // èœå•æ æç¤ºä¸ºä¸‹æ ‡ é»˜è®¤up  æ— æ•ˆï¼Ÿ
      // this.editor.config.menuTooltipPosition = 'down'

      // æ’å…¥ç½‘ç»œå›¾ç‰‡çš„å›è°ƒ
      // this.editor.config.linkImgCallback = function (src,alt,href) {
      //   console.log('å›¾ç‰‡ src ', src)
      //   console.log('å›¾ç‰‡æ–‡å­—è¯´æ˜',alt)
      //   console.log('è·³è½¬é“¾æ¥',href)
      // }

      // è‡ªå®šä¹‰æ£€æŸ¥æ’å…¥è§†é¢‘çš„å›è°ƒ
      // this.editor.config.onlineVideoCallback = function (video) {
      // è‡ªå®šä¹‰å›è°ƒå†…å®¹ï¼Œå†…å®¹æˆåŠŸæ’å…¥åä¼šæ‰§è¡Œè¯¥å‡½æ•°
      //   console.log('æ’å…¥è§†é¢‘å†…å®¹', video)
      // }

      this.editor.create()
      console.log('this.editor.txt.html()', this.editor.txt.html())
      console.log('this.editor.txt.getJSON()', this.editor.txt.getJSON())
    },
    htmlChange (html) {
      console.log('html', html)
    }
  }
}
</script>

<style lang='css'>
.editor {
  width: 100%;
  margin: 0 auto;
  position: relative;
  z-index: 0;
  text-align: left;
}
.toolbar {
  border: 1px solid #ccc;
}
.text {
  border: 1px solid #ccc;
  min-height: 500px;
}
</style>
